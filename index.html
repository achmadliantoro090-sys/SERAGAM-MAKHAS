<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MA KHAS KEMPEK v13.7 - STOK SERAGAM</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        :root { --primary: #064e3b; --accent: #10b981; --bg-body: #f0fdf4; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Open Sans', sans-serif; background: var(--bg-body); color: #064e3b; }
        .font-heading { font-family: 'Montserrat', sans-serif; }
        .sidebar { background: var(--primary); height: 100vh; width: 260px; position: fixed; left: 0; top: 0; z-index: 1000; }
        .main-content { margin-left: 260px; padding: 25px; min-height: 100vh; }
        .logo-container { padding: 30px 20px; text-align: center; background: rgba(0,0,0,0.2); }
        .logo-img { width: 85px; height: 85px; background: white; padding: 5px; border-radius: 18px; object-fit: contain; margin: 0 auto 15px; display: block; }
        .nav-link { display: flex; align-items: center; gap: 12px; padding: 14px 20px; color: #a7f3d0; font-size: 13px; font-weight: 600; cursor: pointer; border-radius: 12px; margin: 4px 15px; }
        .active-menu { background: var(--accent) !important; color: white !important; }
        .page-content { display: none; animation: fadeIn 0.3s ease; }
        .page-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .card { background: white; border-radius: 24px; border: 1px solid #d1fae5; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
        .input-box { width: 100%; padding: 12px 16px; background: #f9fafb; border: 2px solid #d1fae5; border-radius: 12px; outline: none; }
        .btn-rekap { width: 100%; text-align: left; color: #a7f3d0; font-size: 11px; font-weight: 700; padding: 12px 20px; border-top: 1px solid rgba(255,255,255,0.05); }
        .btn-rekap:hover { background: rgba(255,255,255,0.1); color: white; }
        #modal-filter { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 2000; align-items: center; justify-content: center; padding: 20px; }
        .modal-card { background: white; width: 100%; max-width: 350px; border-radius: 24px; padding: 25px; }
        @media (max-width: 1024px) { .sidebar { transform: translateX(-100%); transition: 0.3s; } .sidebar.open { transform: translateX(0); } .main-content { margin-left: 0; } }
    </style>
</head>
<body>

    <div id="modal-filter">
        <div class="modal-card">
            <h4 id="modal-title" class="font-heading font-black text-emerald-900 mb-1 uppercase italic text-sm">REKAP</h4>
            <p class="text-[10px] text-slate-400 mb-6 font-bold uppercase tracking-widest">Tentukan Rentang Tanggal</p>
            <div class="space-y-4">
                <div>
                    <label class="text-[9px] font-black text-slate-400 uppercase ml-1">Tanggal Mulai</label>
                    <input id="date-start" type="date" class="input-box text-sm">
                </div>
                <div>
                    <label class="text-[9px] font-black text-slate-400 uppercase ml-1">Tanggal Sampai</label>
                    <input id="date-end" type="date" class="input-box text-sm">
                </div>
            </div>
            <div class="grid grid-cols-2 gap-3 mt-8">
                <button onclick="closeModal()" class="py-3 bg-slate-100 text-slate-500 rounded-xl font-bold text-[10px] uppercase">Batal</button>
                <button onclick="processDownload()" class="py-3 bg-emerald-600 text-white rounded-xl font-bold text-[10px] uppercase shadow-lg">Download</button>
            </div>
        </div>
    </div>

    <aside id="sidebar" class="sidebar">
        <div class="logo-container">
            <img id="img-display" src="https://via.placeholder.com/150?text=LOGO" class="logo-img">
            <h3 id="disp-nama" class="text-white font-heading text-sm uppercase italic font-black">MA KHAS KEMPEK</h3>
            <p id="disp-tag" class="text-emerald-300 text-[9px] font-heading font-bold uppercase mt-1 italic">Official Store</p>
        </div>
        
        <nav class="mt-4">
            <div onclick="switchMenu('dashboard')" id="m-dashboard" class="nav-link active-menu"><i class="fa-solid fa-house-chimney w-5"></i> Dashboard</div>
            <div onclick="switchMenu('stok')" id="m-stok" class="nav-link"><i class="fa-solid fa-boxes-stacked w-5"></i> Stok Seragam</div>
            <div onclick="switchMenu('beli')" id="m-beli" class="nav-link"><i class="fa-solid fa-plus-circle w-5"></i> Tambah Stok</div>
            <div onclick="switchMenu('jual')" id="m-jual" class="nav-link"><i class="fa-solid fa-cart-shopping w-5"></i> Penjualan</div>
            <div onclick="switchMenu('kurang')" id="m-kurang" class="nav-link"><i class="fa-solid fa-clock-rotate-left w-5"></i> Daftar Kurangan</div>
            <div onclick="switchMenu('profil')" id="m-profil" class="nav-link"><i class="fa-solid fa-gears w-5"></i> Pengaturan</div>
        </nav>

        <div class="absolute bottom-0 w-full bg-[#042f24] pt-2">
            <button onclick="openExport('PENJUALAN')" class="btn-rekap"><i class="fa-solid fa-file-export mr-3"></i> REKAP PENJUALAN</button>
            <button onclick="openExport('KURANGAN')" class="btn-rekap"><i class="fa-solid fa-file-circle-exclamation mr-3"></i> REKAP KURANGAN</button>
            <button onclick="downloadStok()" class="btn-rekap"><i class="fa-solid fa-box-archive mr-3"></i> REKAP STOK SERAGAM</button>
        </div>
    </aside>

    <main class="main-content">
        <header class="flex justify-between items-center mb-8 bg-white p-6 rounded-3xl border border-emerald-100 shadow-sm">
            <h2 id="header-title" class="text-sm font-heading font-extrabold text-emerald-900 uppercase italic">DASHBOARD</h2>
            <button onclick="toggleSidebar()" class="lg:hidden text-emerald-900"><i class="fa-solid fa-bars-staggered text-xl"></i></button>
        </header>

        <div id="p-dashboard" class="page-content active">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <div class="card p-8 border-l-8 border-emerald-500">
                    <p class="text-[11px] font-bold text-slate-400 uppercase tracking-widest">Total Stok Seragam</p>
                    <h3 id="stat-total" class="text-5xl font-black text-emerald-900 mt-2">0</h3>
                </div>
                <div class="card p-8 bg-emerald-600 text-white shadow-lg">
                    <p class="text-[11px] font-bold text-emerald-100 uppercase tracking-widest">Siswa Belum Terima</p>
                    <h3 id="stat-kurang" class="text-5xl font-black mt-2">0</h3>
                </div>
            </div>
            <div class="card p-8"><h4 class="font-heading font-bold text-xs uppercase text-emerald-900 mb-6">Aktivitas Terakhir</h4><div id="activity-log" class="space-y-4"></div></div>
        </div>

        <div id="p-stok" class="page-content">
            <div class="flex gap-4 mb-8">
                <button onclick="renderStok('PUTRA')" class="flex-1 bg-emerald-900 text-white font-heading font-bold py-4 rounded-2xl text-[10px] uppercase">SERAGAM PUTRA</button>
                <button onclick="renderStok('PUTRI')" class="flex-1 bg-emerald-500 text-white font-heading font-bold py-4 rounded-2xl text-[10px] uppercase">SERAGAM PUTRI</button>
            </div>
            <div id="stok-display" class="space-y-6"></div>
        </div>

        <div id="p-jual" class="page-content">
            <div class="max-w-5xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="card p-8 border-t-4 border-emerald-500 shadow-xl">
                    <input id="out-nama" type="text" placeholder="NAMA SISWA" class="input-box font-bold uppercase mb-4">
                    <div class="flex gap-2 mb-6">
                        <button onclick="setPay('CASH')" id="pay-cash" class="pay-btn flex-1 py-3 rounded-xl font-bold text-[10px] bg-emerald-600 text-white">CASH</button>
                        <button onclick="setPay('SIMAK')" id="pay-simak" class="pay-btn flex-1 py-3 rounded-xl font-bold text-[10px] bg-white text-emerald-600 border border-emerald-100">SIMAK</button>
                    </div>
                    <div class="grid grid-cols-2 gap-3 mb-3">
                        <select id="out-cat" onchange="updateItems('out')" class="input-box font-bold text-xs"></select>
                        <select id="out-size" onchange="checkLive()" class="input-box font-bold text-xs"></select>
                    </div>
                    <select id="out-item" onchange="checkLive()" class="input-box mb-4 font-bold text-xs"></select>
                    <div class="flex justify-between items-center bg-emerald-50 p-4 rounded-xl">
                        <span class="text-[10px] font-bold uppercase">Tersedia: <b id="live-stok" class="text-lg ml-1">0</b></span>
                        <button onclick="addToCart()" class="bg-emerald-900 text-white px-6 py-2 rounded-lg font-bold text-[10px] uppercase">Tambah</button>
                    </div>
                </div>
                <div class="card p-8 bg-emerald-900 text-white shadow-xl"><div id="cart-list" class="space-y-3 mb-8 min-h-[150px]"></div><button onclick="prosesJualMulti()" id="btn-proses" class="w-full bg-emerald-400 text-emerald-950 py-4 rounded-xl font-black uppercase text-[10px] hidden">Simpan Data</button></div>
            </div>
        </div>

        <div id="p-kurang" class="page-content">
            <div class="card p-8 mb-8 border-l-4 border-emerald-500 shadow-md">
                <input id="man-nama" type="text" placeholder="NAMA SISWA" class="input-box font-bold uppercase mb-4">
                <div class="grid grid-cols-2 gap-4 mb-4"><select id="man-cat" onchange="renderMultiItems()" class="input-box font-bold text-xs"></select><select id="man-size" class="input-box font-bold text-xs"></select></div>
                <div id="multi-item-container" class="flex flex-wrap gap-2 mb-4"></div>
                <button onclick="submitKurangMulti()" class="w-full btn-primary py-4 uppercase text-[10px]">Catat Kurangan</button>
            </div>
            <div class="card p-4 overflow-x-auto"><table class="w-full text-left text-sm"><thead><tr class="bg-emerald-50 text-[9px] uppercase font-black text-emerald-700"><th class="p-4">Nama Siswa</th><th class="p-4">Barang</th><th class="p-4 text-right">Opsi</th></tr></thead><tbody id="kurang-body" class="font-bold"></tbody></table></div>
        </div>

        <div id="p-beli" class="page-content">
            <div class="max-w-xl mx-auto card p-10 border-t-4 border-emerald-500 shadow-xl">
                <div class="grid grid-cols-2 gap-4 mb-4"><select id="in-cat" onchange="updateItems('in')" class="input-box font-bold text-xs"></select><select id="in-size" class="input-box font-bold text-xs"></select></div>
                <select id="in-item" class="input-box mb-6 font-bold text-xs"></select>
                <input id="in-qty" type="number" placeholder="JUMLAH UNIT" class="input-box mb-6 font-bold">
                <button onclick="submitStok()" class="w-full btn-primary py-4 uppercase text-[10px]">Update Stok Seragam</button>
            </div>
        </div>

        <div id="p-profil" class="page-content">
            <div class="max-w-md mx-auto card p-10 text-center">
                <input id="file-logo" type="file" accept="image/*" class="hidden" onchange="uploadFoto(this)">
                <button onclick="document.getElementById('file-logo').click()" class="text-[10px] font-bold text-emerald-600 mb-6 block underline uppercase tracking-widest">Ganti Logo</button>
                <input id="p-name" type="text" class="input-box mb-4" placeholder="Nama Sekolah">
                <input id="p-tag" type="text" class="input-box mb-6" placeholder="Tagline">
                <button onclick="saveProf()" class="w-full btn-primary py-4 uppercase text-[10px]">Simpan Perubahan</button>
                <button onclick="resetHanyaStok()" class="w-full mt-10 bg-red-50 text-red-700 py-3 rounded-xl font-bold uppercase text-[9px]">Kosongkan Semua Stok</button>
            </div>
        </div>
    </main>

    <script>
        const sizes = ["S", "M", "L", "XL", "XXL", "3XL", "4XL", "5XL"];
        const items = { 
            PUTRA: ["Baju Pramuka Pa", "Baju Putih Pa", "Baju Batik Pa", "Celana Abu", "Celana Hitam", "Celana Pramuka"], 
            PUTRI: ["Baju Pramuka Pi", "Baju Putih Pi", "Baju Batik Pi", "Rok Abu", "Rok Hitam", "Rok Pramuka"] 
        };
        
        const VER = "v13.7";
        let db = JSON.parse(localStorage.getItem('ma_db_'+VER)) || { PUTRA: {}, PUTRI: {} };
        let logs = JSON.parse(localStorage.getItem('ma_lg_'+VER)) || [];
        let kurangan = JSON.parse(localStorage.getItem('ma_kr_'+VER)) || [];
        let sales = JSON.parse(localStorage.getItem('ma_sl_'+VER)) || [];
        let config = JSON.parse(localStorage.getItem('ma_cf_'+VER)) || { n: "MA KHAS KEMPEK", t: "Official Store", img: "" };
        let payType = 'CASH', cart = [], selectedKurang = [], activeExport = '';

        function init() {
            document.getElementById('disp-nama').innerText = config.n;
            document.getElementById('disp-tag').innerText = config.t;
            document.getElementById('p-name').value = config.n;
            document.getElementById('p-tag').value = config.t;
            if(config.img) document.getElementById('img-display').src = config.img;
            ['PUTRA', 'PUTRI'].forEach(c => items[c].forEach(i => { if(!db[c][i]) db[c][i] = {}; sizes.forEach(s => { if(db[c][i][s] === undefined) db[c][i][s] = 0; }); }));
            ['in', 'out', 'man'].forEach(pre => { 
                const el = document.getElementById(pre + '-cat'); if(el){ el.innerHTML = '<option value="PUTRA">PUTRA</option><option value="PUTRI">PUTRI</option>'; updateItems(pre); }
                const sz = document.getElementById(pre + '-size'); if(sz) sz.innerHTML = sizes.map(s => `<option value="${s}">${s}</option>`).join('');
            });
            renderMultiItems(); updateDash();
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date-start').value = today; document.getElementById('date-end').value = today;
        }

        // --- FILTERED EXPORT ---
        function openExport(type) {
            activeExport = type;
            document.getElementById('modal-title').innerText = "REKAP " + type;
            document.getElementById('modal-filter').style.display = 'flex';
        }

        function closeModal() { document.getElementById('modal-filter').style.display = 'none'; }

        function processDownload() {
            const start = new Date(document.getElementById('date-start').value);
            const end = new Date(document.getElementById('date-end').value);
            end.setHours(23, 59, 59);

            let data = [], fileName = "";

            if(activeExport === 'PENJUALAN') {
                data = sales.filter(s => { const d = new Date(s.rawDate); return d >= start && d <= end; })
                             .map(s => ({ TANGGAL: s.d, JAM: s.t, SISWA: s.n, BARANG: s.i, UKURAN: s.s, BAYAR: s.p }));
                fileName = `REKAP_PENJUALAN_${document.getElementById('date-start').value}.xlsx`;
            } else if(activeExport === 'KURANGAN') {
                data = kurangan.filter(k => { const d = new Date(k.rawDate); return d >= start && d <= end; })
                               .map(k => ({ TANGGAL_INDEN: k.d, SISWA: k.n, BARANG: k.i, UKURAN: k.s }));
                fileName = `REKAP_KURANGAN_${document.getElementById('date-start').value}.xlsx`;
            }

            if(data.length === 0) return alert("Tidak ada data pada tanggal tersebut!");
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(data), activeExport);
            XLSX.writeFile(wb, fileName);
            closeModal();
        }

        function downloadStok() {
            let data = [];
            ['PUTRA','PUTRI'].forEach(c => Object.keys(db[c]).forEach(itm => { 
                let r = { KATEGORI: c, BARANG: itm }; 
                sizes.forEach(s => r[s] = db[c][itm][s]); 
                data.push(r); 
            }));
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(data), "STOK_SERAGAM");
            XLSX.writeFile(wb, `REKAP_STOK_SERAGAM_${new Date().toLocaleDateString()}.xlsx`);
        }

        // --- CORE ---
        function addLog(type, user, msg) {
            logs.unshift({ t: new Date().toLocaleTimeString('id-ID'), d: new Date().toLocaleDateString('id-ID'), rawDate: new Date().toISOString(), type, user, msg });
            if(logs.length > 50) logs.pop(); save();
        }

        function prosesJualMulti() {
            const n = document.getElementById('out-nama').value.toUpperCase(); if(!n) return alert("Isi Nama!");
            cart.forEach(c => {
                const itemData = { n, i: c.itm, s: c.sz, d: new Date().toLocaleDateString('id-ID'), t: new Date().toLocaleTimeString('id-ID'), rawDate: new Date().toISOString() };
                if(c.status === 'READY') { 
                    db[c.cat][c.itm][c.sz]--; 
                    sales.push({ ...itemData, p: payType });
                    addLog('JUAL', n, `Beli ${c.itm} (${c.sz})`);
                } else { 
                    kurangan.push(itemData);
                    addLog('KURANG', n, `Inden ${c.itm} (${c.sz})`);
                }
            });
            save(); cart = []; document.getElementById('out-nama').value = ""; renderCart(); checkLive(); alert("Data Tersimpan!");
        }

        function lunas(x) {
            const k = kurangan[x]; if(db[k.c || 'PUTRA'][k.i][k.s] <= 0) return alert("Stok Seragam Kosong!");
            db[k.c || 'PUTRA'][k.i][k.s]--; 
            sales.push({ ...k, p: 'PELUNASAN', d: new Date().toLocaleDateString('id-ID'), t: new Date().toLocaleTimeString('id-ID'), rawDate: new Date().toISOString() });
            addLog('JUAL', k.n, `Lunas ${k.i} (${k.s})`);
            kurangan.splice(x, 1); save(); renderKurang();
        }

        function save() { 
            localStorage.setItem('ma_db_'+VER, JSON.stringify(db)); 
            localStorage.setItem('ma_lg_'+VER, JSON.stringify(logs)); 
            localStorage.setItem('ma_kr_'+VER, JSON.stringify(kurangan)); 
            localStorage.setItem('ma_sl_'+VER, JSON.stringify(sales)); 
            localStorage.setItem('ma_cf_'+VER, JSON.stringify(config)); 
            updateDash(); 
        }

        // --- UI UTILS ---
        function addToCart() { const cat = document.getElementById('out-cat').value, itm = document.getElementById('out-item').value, sz = document.getElementById('out-size').value; cart.push({ cat, itm, sz, status: db[cat][itm][sz] <= 0 ? 'KURANG' : 'READY' }); renderCart(); }
        function renderCart() { const c = document.getElementById('cart-list'), b = document.getElementById('btn-proses'); b.className = cart.length ? 'w-full bg-emerald-400 text-emerald-950 py-4 rounded-xl font-black uppercase text-[10px] block' : 'hidden'; c.innerHTML = cart.map((i, x) => `<div class="flex justify-between bg-[#042f24] p-3 rounded-xl border border-emerald-800"><div class="text-[10px] font-bold">${i.itm} (${i.sz}) <span class="block text-[8px] ${i.status === 'KURANG' ? 'text-orange-400' : 'text-emerald-400'}">${i.status}</span></div><button onclick="cart.splice(${x},1);renderCart()" class="text-red-400 px-2"><i class="fa-solid fa-trash"></i></button></div>`).join(''); }
        function submitStok() { const c = document.getElementById('in-cat').value, i = document.getElementById('in-item').value, s = document.getElementById('in-size').value, q = parseInt(document.getElementById('in-qty').value); if(!q) return; db[c][i][s] += q; addLog('MASUK', 'STOK', `+${q} ${i} (${s})`); save(); alert("Stok Seragam Ditambah!"); document.getElementById('in-qty').value = ""; }
        function renderStok(cat) { const container = document.getElementById('stok-display'); container.innerHTML = ""; Object.keys(db[cat]).forEach(itm => { let grid = sizes.map(s => `<div class="p-2 bg-white border rounded-lg text-center"><p class="text-[8px] font-bold text-slate-400">${s}</p><input type="number" onchange="updStok('${cat}','${itm}','${s}',this.value)" value="${db[cat][itm][s]}" class="w-full text-center font-black text-emerald-900 bg-transparent text-xs"></div>`).join(''); container.innerHTML += `<div class="card p-4 mb-4"><h6 class="font-bold text-[10px] mb-3 uppercase italic">${itm}</h6><div class="grid grid-cols-4 md:grid-cols-8 gap-2">${grid}</div></div>`; }); }
        function renderKurang() { document.getElementById('kurang-body').innerHTML = kurangan.map((k, x) => `<tr><td class="p-4 uppercase text-[10px]">${k.n}</td><td class="p-4 text-[9px] text-slate-500">${k.i} (${k.s})</td><td class="p-4 text-right"><button onclick="lunas(${x})" class="bg-emerald-600 text-white px-3 py-1 rounded-lg text-[8px] font-bold uppercase">Lunas</button></td></tr>`).join(''); }
        function updateDash() { let total = 0; ['PUTRA','PUTRI'].forEach(c => Object.keys(db[c]).forEach(i => sizes.forEach(s => total += db[c][i][s]))); document.getElementById('stat-total').innerText = total; document.getElementById('stat-kurang').innerText = kurangan.length; renderLogs(); }
        function renderLogs() { document.getElementById('activity-log').innerHTML = logs.slice(0, 10).map(l => `<div class="flex items-center gap-3 p-3 bg-white border border-emerald-50 rounded-2xl"><div class="w-2 h-2 rounded-full ${l.type==='MASUK'?'bg-emerald-500':'bg-blue-500'}"></div><div class="flex-1"><h5 class="text-[9px] font-black uppercase">${l.user}</h5><p class="text-[9px] text-slate-500">${l.msg}</p></div></div>`).join(''); }
        function switchMenu(id) { document.querySelectorAll('.page-content').forEach(p => p.classList.remove('active')); document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active-menu')); document.getElementById('p-'+id).classList.add('active'); if(id !== 'profil') document.getElementById('m-'+id).classList.add('active-menu'); document.getElementById('header-title').innerText = id.toUpperCase(); if(id === 'stok') renderStok('PUTRA'); if(id === 'kurang') renderKurang(); }
        function renderMultiItems() { const cat = document.getElementById('man-cat').value; document.getElementById('multi-item-container').innerHTML = items[cat].map(i => `<div onclick="toggleChip(this,'${i}')" class="border-2 border-emerald-50 p-2 rounded-lg text-[9px] font-bold cursor-pointer hover:bg-emerald-50">${i}</div>`).join(''); selectedKurang = []; }
        function toggleChip(el, i) { if(selectedKurang.includes(i)) { selectedKurang = selectedKurang.filter(x => x !== i); el.classList.remove('bg-emerald-600', 'text-white'); } else { selectedKurang.push(i); el.classList.add('bg-emerald-600', 'text-white'); } }
        function submitKurangMulti() { const n = document.getElementById('man-nama').value.toUpperCase(), c = document.getElementById('man-cat').value, s = document.getElementById('man-size').value; if(!n || selectedKurang.length === 0) return alert("Lengkapi!"); selectedKurang.forEach(itm => { kurangan.push({ n, c, i: itm, s, d: new Date().toLocaleDateString('id-ID'), rawDate: new Date().toISOString() }); addLog('KURANG', n, `Inden: ${itm} (${s})`); }); save(); document.getElementById('man-nama').value = ""; renderMultiItems(); renderKurang(); alert("Selesai!"); }
        function setPay(t) { payType = t; document.querySelectorAll('.pay-btn').forEach(b => { b.classList.remove('bg-emerald-600','text-white'); b.classList.add('bg-white','text-emerald-600'); }); document.getElementById('pay-'+t.toLowerCase()).classList.add('bg-emerald-600','text-white'); }
        function updateItems(pre) { const cat = document.getElementById(pre + '-cat').value, el = document.getElementById(pre + '-item'); if(el) el.innerHTML = items[cat].map(i => `<option value="${i}">${i}</option>`).join(''); if(pre === 'out') checkLive(); }
        function checkLive() { const c = document.getElementById('out-cat').value, i = document.getElementById('out-item').value, s = document.getElementById('out-size').value; document.getElementById('live-stok').innerText = db[c][i][s] || 0; }
        function updStok(c,i,s,v) { db[c][i][s] = parseInt(v)||0; save(); }
        function saveProf() { config.n = document.getElementById('p-name').value; config.t = document.getElementById('p-tag').value; save(); alert("Nama Toko Diupdate!"); location.reload(); }
        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); }
        function uploadFoto(i) { if(i.files && i.files[0]) { const r = new FileReader(); r.onload = (e) => { config.img = e.target.result; document.getElementById('img-display').src = config.img; save(); }; r.readAsDataURL(i.files[0]); } }
        function resetHanyaStok() { if(confirm("Nol-kan semua stok seragam?")) { ['PUTRA', 'PUTRI'].forEach(c => Object.keys(db[c]).forEach(itm => sizes.forEach(s => db[c][itm][s] = 0))); save(); location.reload(); } }
        window.onload = init;
    </script>
</body>
</html>
